<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="slide">
      <div class="overlap-wrapper">
        <div class="overlap">
          <div class="view">
            <div class="div">
              <div class="overlap-group">
                <div class="view-2">
                  <textarea id="textInput" class="fixed-textarea" placeholder="Введите текст..."></textarea>
                </div>
              </div>
              <img class="line" src="icons/line-1.svg" />
              <div class="view-3">
                <div class="disk-wrapper">
                  <img class="disk" src="icons/disk.svg" />
                </div>
                <div class="undo-wrapper">
                  <img class="undo" src="icons/undo.svg" />
                </div>
                <div class="redo-wrapper">
                  <img class="redo" src="icons/redo.svg" />
                </div>
              </div>
            </div>
            <div class="view-4">
              <div class="view-wrapper">
                <div class="view-5">
                  <div class="angle-right-wrapper">
                    <img class="angle-right" src="icons/angle-right.svg" />
                  </div>
                  <div class="play-wrapper">
                    <img class="play" src="icons/play.svg" />
                  </div>
                  <div class="angle-left-wrapper">
                    <img class="angle-left" src="icons/angle-left.svg" />
                  </div>
                </div>
              </div>
              <div class="view-6">
                <input type="text" id="playlistInput" placeholder="..." style="width: 280px; font-size: 40px; border-radius: 6px; border: 1px solid #ccc; padding: 2px 8px;" />
              </div>
            </div>
            <div class="overlap-group-wrapper">
              <div class="overlap-2">
                <!-- <div class="rectangle"></div> -->
                <div class="text-wrapper">Количество слов: <span id="wordCountDisplay">0</span></div>
              </div>
            </div>
            <div class="view-7">
              <div class="pause-wrapper" id="pauseBtn" style="cursor:pointer;">
                <img class="pause" src="icons/pause.svg" />
              </div>
              <div class="div-wrapper"><div class="text-wrapper-2" id="timerDisplay">30:00</div></div>
            </div>
            <img
              class="element-simple"
              src="icons/stepler.png"
            />
          </div>
          <div class="menu-burger-wrapper">
            <div class="menu-burger">
              <img class="group" src="icons/menu-burger.svg" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      const apiBase = 'http://localhost:5000/api/writer';
      async function updateTextAndCount() {
        const text = document.getElementById('textInput').value;
        const res = await fetch(apiBase + '/countwords', {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: text
        });
        let count = await res.json();
        if (typeof count !== 'number') {
          count = Number(count) || 0;
        }
        document.getElementById('wordCountDisplay').innerText = count;
      }
      setInterval(updateTextAndCount, 1000);

      let timerRunning = false;
      let timerInterval = null;
      async function getTimer() {
        const res = await fetch(apiBase + '/gettimer');
        if (res.ok) {
          const time = await res.text();
          document.getElementById('timerDisplay').innerText = time;
        }
      }
      async function toggleTimer() {
        if (!timerRunning) {
          await fetch(apiBase + '/starttimer?minutes=30', { method: 'POST' });
          timerRunning = true;
          timerInterval = setInterval(getTimer, 1000);
        } else {
          await fetch(apiBase + '/stoptimer', { method: 'POST' });
          timerRunning = false;
          clearInterval(timerInterval);
        }
      }
      document.getElementById('pauseBtn').addEventListener('click', toggleTimer);
      // Первичная инициализация времени
      getTimer();
    </script>
  </body>
</html>